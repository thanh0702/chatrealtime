import{c as ie,r as c,h as re,a as le,u as ce,s as de,j as e,U as E,b as F,e as N,_ as oe,d as k}from"./index-DbFX07ia.js";import{H as xe,M}from"./message-circle-SeM6PXJU.js";/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v=ie("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),me=[{key:"friends",label:"Friends",icon:E},{key:"received",label:"Received",icon:F},{key:"sent",label:"Sent",icon:N},{key:"search",label:"Search",icon:v}],ue=()=>{const[l,L]=c.useState("friends"),[q,T]=c.useState(""),[b,P]=c.useState(""),[R,o]=c.useState([]),[Q,C]=c.useState(!1),w=re(),{friends:m,sentRequests:f,receivedRequests:j,isFriendsLoading:O,isSentRequestsLoading:D,isReceivedRequestsLoading:H,fetchFriends:U,fetchSentRequests:_,fetchReceivedRequests:S,acceptFriendRequest:Y,declineFriendRequest:$,cancelFriendRequest:B,unfriend:X,setSelectedUser:z,sendFriendRequest:G}=le(),{onlineUsers:J,authUser:K}=ce(),[V,d]=c.useState([]),u=c.useRef(null);m.filter(s=>s.fullName.toLowerCase().includes(q.toLowerCase())),c.useEffect(()=>{if(l!=="search"||!b.trim()){o([]);return}let s=!1;return C(!0),u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{(async()=>{try{const t=await de(b,!0);s||o(t||[])}catch{s||o([])}finally{s||C(!1)}})()},400),()=>{s=!0,u.current&&clearTimeout(u.current)}},[l,b]),c.useEffect(()=>{U(),_(),S()},[]);const h=s=>V.includes(s),A=async s=>{var t,n;d(i=>[...i,s]);try{await G(s),o(i=>i.map(a=>a._id===s?{...a,_justSent:!0}:a))}catch(i){const a=((n=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:n.message)||"Error sending friend request";a.includes("already friends")?o(x=>x.map(r=>r._id===s?{...r,_isFriend:!0}:r)):a.includes("already exists")&&o(x=>x.map(r=>r._id===s?{...r,_justSent:!0}:r)),!a.includes("already friends")&&!a.includes("already exists")&&oe.error(a)}finally{d(i=>i.filter(a=>a!==s)),_()}},W=async s=>{d(t=>[...t,s]);try{await B(s),o(t=>t.map(n=>n._id===s?{...n,_justSent:!1}:n))}finally{d(t=>t.filter(n=>n!==s)),_()}},Z=async s=>{d(t=>[...t,s]);try{await Y(s)}finally{d(t=>t.filter(n=>n!==s)),S(),U()}},I=async s=>{d(t=>[...t,s]);try{await $(s)}finally{d(t=>t.filter(n=>n!==s)),S()}},ee=async s=>{try{await X(s)}catch(t){console.error("Error unfriending:",t)}},se=s=>{z(s),w("/")},te=s=>{z(s),w("/")},ne=()=>{w("/")},p=({user:s,type:t="friend",onAction:n})=>{const i=J.includes(s._id);let a=!1,x=!1,r=!1;return t==="search"&&(a=f.some(g=>g.recipient._id===s._id)||s._justSent,x=m.some(g=>g._id===s._id)||s._isFriend,r=j.some(g=>g.requester._id===s._id)),e.jsxs("div",{className:"bg-base-300 rounded-xl shadow-sm border border-base-200 hover:border-primary/30 transition-all duration-200 group flex items-center px-5 py-4 gap-4",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("img",{src:s.profilePic||"/avatar.png",alt:s.fullName,className:"w-14 h-14 rounded-full object-cover shadow",loading:"lazy"}),i&&e.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-success rounded-full border-2 border-base-300"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-lg text-base-content truncate",children:s.fullName}),e.jsx("div",{className:"text-sm text-base-content/60",children:i?"Online":"Offline"})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[t==="friend"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-circle btn-sm bg-transparent text-success hover:bg-success/10",title:"Message",onClick:()=>n(s,"message"),disabled:h(s._id),children:e.jsx(M,{size:18})}),e.jsx("button",{onClick:()=>n(s._id,"unfriend"),className:"btn btn-circle btn-sm bg-transparent text-error hover:bg-error/10",title:"Unfriend",disabled:h(s._id),children:e.jsx(k,{size:18})})]}),t==="sent"&&e.jsx("button",{onClick:()=>n(s._id),className:"btn btn-circle btn-sm bg-transparent text-warning hover:bg-warning/10",title:"Cancel Request",disabled:h(s._id),children:e.jsx(k,{size:18})}),t==="received"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>n(s._id,"accept"),className:"btn btn-circle btn-sm bg-primary hover:bg-primary/10 text-primary-content",title:"Accept",disabled:h(s._id),children:e.jsx(N,{size:18})}),e.jsx("button",{onClick:()=>n(s._id,"decline"),className:"btn btn-circle btn-sm bg-transparent text-error hover:bg-error/10",title:"Decline",disabled:h(s._id),children:e.jsx(k,{size:18})})]}),t==="search"&&!x&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-circle btn-sm bg-transparent text-success hover:bg-success/10",title:"Message",onClick:()=>te(s),children:e.jsx(M,{size:18})}),e.jsx("button",{onClick:()=>A(s._id),className:`btn btn-circle btn-sm bg-primary hover:bg-primary/10 text-primary-content ${a||r?"cursor-default":""}`,title:r?"Đã nhận lời mời":"Add Friend",disabled:a||h(s._id)||r,children:e.jsx(F,{size:18})})]}),t==="search"&&x&&e.jsx("button",{className:"btn btn-circle btn-sm bg-success/10 text-success cursor-default",title:"Friends",disabled:!0,children:e.jsx(N,{size:18})})]})]})},y=()=>e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(s=>e.jsxs("div",{className:"bg-base-100 rounded-lg shadow-sm border border-base-300 p-4 animate-pulse",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:"w-12 h-12 bg-base-300 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"h-4 bg-base-300 rounded w-3/4 mb-1.5"}),e.jsx("div",{className:"h-3 bg-base-300 rounded w-1/2"})]})]}),e.jsxs("div",{className:"flex gap-1 flex-shrink-0",children:[e.jsx("div",{className:"w-6 h-6 bg-base-300 rounded-full"}),e.jsx("div",{className:"w-6 h-6 bg-base-300 rounded-full"})]})]}),e.jsx("div",{className:"h-6 bg-base-300 rounded"})]},s))}),ae=s=>{L(s)};return e.jsx("div",{className:"min-h-screen bg-base-200 pt-16",children:e.jsx("div",{className:"max-w-7xl mx-auto py-8 px-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsxs("aside",{className:"lg:w-64 bg-base-100 rounded-xl shadow p-6 h-fit",children:[e.jsx("h2",{className:"text-2xl font-bold text-base-content mb-6",children:"Friends"}),e.jsx("div",{className:"flex flex-col gap-3",children:me.map(s=>e.jsxs("button",{className:`flex items-center gap-3 px-4 py-3 rounded-lg font-medium transition-all duration-200
                    ${l===s.key?"bg-primary text-primary-content shadow-md":"text-base-content/60 hover:text-base-content hover:bg-base-200"}
                  `,onClick:()=>ae(s.key),children:[e.jsx(s.icon,{size:20}),e.jsx("span",{children:s.label}),s.key!=="search"&&e.jsx("span",{className:"ml-auto bg-base-content/20 text-base-content px-2 py-0.5 rounded-full text-xs",children:s.key==="friends"?m.length:s.key==="received"?j.length:f.length})]},s.key))})]}),e.jsxs("main",{className:"flex-1",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"bg-primary/10 p-2 rounded-lg",children:e.jsx(xe,{className:"w-6 h-6 text-primary"})}),e.jsx("h1",{className:"text-3xl font-bold text-base-content",children:"My Connections"})]}),e.jsx("p",{className:"text-base-content/60 text-base",children:"Manage your connections and friend requests"})]}),l==="friends"&&e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-base-content/40 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search friends...",value:q,onChange:s=>T(s.target.value),className:"w-full pl-10 pr-4 py-3 bg-base-100 border border-base-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all duration-200"})]})}),l==="search"&&e.jsxs("div",{className:"relative",children:[e.jsx(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-base-content/40 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search by name or email...",value:b,onChange:s=>P(s.target.value),className:"w-full pl-10 pr-4 py-3 bg-base-100 border border-base-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all duration-200"})]}),e.jsxs("div",{className:"space-y-8",children:[l==="friends"&&e.jsx("div",{children:O?e.jsx(y,{}):m.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"bg-base-100 rounded-full w-20 h-20 mx-auto mb-4 flex items-center justify-center",children:e.jsx(E,{className:"w-10 h-10 text-base-content/30"})}),e.jsx("h3",{className:"text-xl font-semibold text-base-content mb-2",children:"No friends yet"}),e.jsx("p",{className:"text-base-content/60 mb-6 text-base",children:"Start connecting with people to see them here"}),e.jsxs("button",{className:"btn btn-primary gap-2",onClick:ne,children:[e.jsx(v,{size:18}),"Find Friends"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(s=>e.jsx(p,{user:s,type:"friend",onAction:(t,n)=>{n==="message"?se(s):ee(t)}},s._id))})}),l==="search"&&e.jsx("div",{children:Q?e.jsx(y,{}):b.trim()===""?e.jsx("div",{className:"text-center text-base-content/60 py-16",children:"Enter a name or email to search for users."}):R.length===0?e.jsx("div",{className:"text-center text-base-content/60 py-16",children:"No users found."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:R.filter(s=>s._id!==K._id&&!m.some(t=>t._id===s._id)).map(s=>e.jsx(p,{user:s,type:"search",onAction:async t=>{await A(t)}},s._id))})}),l==="received"&&e.jsx("div",{children:H?e.jsx(y,{}):j.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"bg-base-100 rounded-full w-20 h-20 mx-auto mb-4 flex items-center justify-center",children:e.jsx(F,{className:"w-10 h-10 text-base-content/30"})}),e.jsx("h3",{className:"text-xl font-semibold text-base-content mb-2",children:"No pending requests"}),e.jsx("p",{className:"text-base-content/60 text-base",children:"You don't have any friend requests waiting"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:j.map(s=>e.jsx(p,{user:s.requester,type:"received",onAction:(t,n)=>{n==="accept"?Z(t):n==="decline"&&I(t)}},s._id))})}),l==="sent"&&e.jsx("div",{children:D?e.jsx(y,{}):f.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"bg-base-100 rounded-full w-20 h-20 mx-auto mb-4 flex items-center justify-center",children:e.jsx(N,{className:"w-10 h-10 text-base-content/30"})}),e.jsx("h3",{className:"text-xl font-semibold text-base-content mb-2",children:"No sent requests"}),e.jsx("p",{className:"text-base-content/60 text-base",children:"You haven't sent any friend requests yet"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:f.map(s=>e.jsx(p,{user:s.recipient,type:"sent",onAction:W},s._id))})})]})]})]})})})};export{ue as default};
